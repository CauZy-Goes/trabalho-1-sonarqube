"use strict";(()=>{var X=Object.defineProperty,z=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var G=(o,s,t)=>s in o?X(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t,R=(o,s)=>{for(var t in s||(s={}))J.call(s,t)&&G(o,t,s[t]);if(A)for(var t of A(s))Z.call(s,t)&&G(o,t,s[t]);return o},N=(o,s)=>z(o,Q(s));var I=(o,s,t)=>new Promise((u,d)=>{var p=i=>{try{r(t.next(i))}catch(E){d(E)}},n=i=>{try{r(t.throw(i))}catch(E){d(E)}},r=i=>i.done?u(i.value):Promise.resolve(i.value).then(p,n);r((t=t.apply(o,s)).next())});var F=()=>{let o=()=>{let s=document.location.href,t=document.querySelector("body"),u=new MutationObserver(()=>{s!==document.location.href&&(s=document.location.href,window.top&&(window.top.postMessage({type:"URL_CHANGED",url:document.location.href},"https://lovable.dev"),window.top.postMessage({type:"URL_CHANGED",url:document.location.href},"http://localhost:3000")))});t&&u.observe(t,{childList:!0,subtree:!0})};window.addEventListener("load",o)};var T=o=>{var s,t,u;(s=window.top)==null||s.postMessage(o,"https://lovable.dev"),(t=window.top)==null||t.postMessage(o,"https://gptengineer.app"),(u=window.top)==null||u.postMessage(o,"http://localhost:3000")};var V=o=>{let s=window.fetch;window.fetch=function(...t){return I(this,null,function*(){var u,d,p;try{let n=yield s(...t);if(!n.ok){let r=n!=null&&n.text?yield n.text():void 0;o("non_200_response",N(R({},n),{status:n.status,url:(t==null?void 0:t[0])||n.url,body:r,method:((u=t==null?void 0:t[1])==null?void 0:u.method)||"GET",origin:window.location.origin}))}return n}catch(n){if(n instanceof TypeError)o("fetch_error",{message:n==null?void 0:n.message,stack:n==null?void 0:n.stack,url:t==null?void 0:t[0],method:((d=t==null?void 0:t[1])==null?void 0:d.method)||"GET",origin:window.location.origin});else{let r={url:t==null?void 0:t[0],method:((p=t==null?void 0:t[1])==null?void 0:p.method)||"GET",origin:window.location.origin,message:"Unknown fetch error",stack:"Not available"};typeof n=="object"&&n!==null&&"message"in n&&typeof n.message=="string"&&(r.message=n.message),typeof n=="object"&&n!==null&&"stack"in n&&typeof n.stack=="string"&&(r.stack=n.stack),o("fetch_error",r)}throw n}})}},k=(()=>{let o=!1,s=({message:t,lineno:u,colno:d,filename:p,error:n})=>({message:t,lineno:u,colno:d,filename:p,stack:n==null?void 0:n.stack});return()=>{if(o)return;let t=new Set,u=r=>{let{lineno:i,colno:E,filename:L,message:h}=r;return`${h}|${L}|${i}|${E}`};V((r,i)=>I(void 0,null,function*(){r==="non_200_response"?T({type:"FETCH_ERROR",error:{message:`failed to call url ${i.url} with status ${i.status} and statusText ${i.statusText}`,status:i.status,statusText:i.statusText,url:i.url,body:i.body}}):r==="fetch_error"&&T({type:"FETCH_ERROR",error:i})}));let p=r=>t.has(r)?!0:(t.add(r),setTimeout(()=>t.delete(r),5e3),!1),n=r=>{let i=u(r);if(p(i))return;let E=s(r);T({type:"RUNTIME_ERROR",error:E})};window.addEventListener("error",n),window.addEventListener("unhandledrejection",r=>{var L,h,O,g,v;if(!((L=r.reason)!=null&&L.stack))return;let i=((h=r.reason)==null?void 0:h.stack)||((O=r.reason)==null?void 0:O.message)||String(r.reason);if(p(i))return;let E={message:((g=r.reason)==null?void 0:g.message)||"Unhandled promise rejection",stack:((v=r.reason)==null?void 0:v.stack)||String(r.reason)};T({type:"UNHANDLED_PROMISE_REJECTION",error:E})}),o=!0}})();var tt={log:console.log,warn:console.warn,error:console.error},et={log:"info",warn:"warning",error:"error"},x=(()=>{let o=!1;return()=>{if(o)return;let s=t=>{console[t]=(...u)=>{tt[t].apply(console,u);let d=null;if(t==="warn"||t==="error"){let p=new Error;p.stack&&(d=p.stack.split(`
`).slice(2).join(`
`))}T({type:"CONSOLE_OUTPUT",level:et[t],message:u.map(p=>typeof p=="object"?JSON.stringify(p):String(p)).join(", ")+(d?`
`+d:""),logged_at:new Date().toISOString()})}};s("log"),s("warn"),s("error"),o=!0}})();var D=(()=>{let o={HIGHLIGHT_COLOR:"#4282C1",HIGHLIGHT_BG:"#4285f41a",ALLOWED_ORIGINS:["https://gptengineer.app","http://localhost:3000","https://lovable.dev"],DEBOUNCE_DELAY:10,Z_INDEX:1e4,TOOLTIP_OFFSET:25,MAX_TOOLTIP_WIDTH:200,SCROLL_DEBOUNCE:420,FULL_WIDTH_TOOLTIP_OFFSET:"12px",HIGHLIGHT_STYLE:{FULL_WIDTH:{OFFSET:"-10px",STYLE:"solid"},NORMAL:{OFFSET:"0",STYLE:"solid"}}};class s{constructor(){this.hoveredElement=null,this.isActive=!1,this.tooltip=null,this.scrollTimeout=null,this.mouseX=0,this.mouseY=0,this.styleElement=null}reset(){this.hoveredElement=null,this.scrollTimeout=null}}let t=new s,u=(e,l)=>{let a;return(...m)=>{clearTimeout(a),a=setTimeout(()=>e(...m),l)}},d=e=>{o.ALLOWED_ORIGINS.forEach(l=>{try{if(!window.parent)return;if(!e||typeof e!="object"){console.error("Invalid message format");return}window.parent.postMessage(e,l)}catch(a){console.error(`Failed to send message to ${l}:`,a)}})},p=()=>{t.tooltip=document.createElement("div"),t.tooltip.className="gpt-selector-tooltip",t.tooltip.setAttribute("role","tooltip"),document.body.appendChild(t.tooltip);let e=document.createElement("style");e.textContent=`
        .gpt-selector-tooltip {
          position: fixed;
          z-index: ${o.Z_INDEX};
          pointer-events: none;
          background-color: ${o.HIGHLIGHT_COLOR};
          color: white;
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 14px;
          font-weight: bold;
          line-height: 1;
          white-space: nowrap;
          display: none;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          transition: opacity 0.2s ease-in-out;
          margin: 0;
        } 
      `,document.head.appendChild(e)},n=e=>{if(!(!t.tooltip||!e))try{let l=e.getBoundingClientRect(),a=e.tagName.toLowerCase(),m=Math.abs(l.width-window.innerWidth)<5;if(t.tooltip.style.maxWidth=`${o.MAX_TOOLTIP_WIDTH}px`,m)t.tooltip.style.left=o.FULL_WIDTH_TOOLTIP_OFFSET,t.tooltip.style.top=o.FULL_WIDTH_TOOLTIP_OFFSET;else{let _=Math.max(0,l.top-o.TOOLTIP_OFFSET);t.tooltip.style.left=`${Math.max(0,l.left)}px`,t.tooltip.style.top=`${_}px`}t.tooltip.textContent=a}catch(l){console.error("Error updating tooltip:",l),S()}},r=e=>{let a=Math.abs(e.getBoundingClientRect().width-window.innerWidth)<5?o.HIGHLIGHT_STYLE.FULL_WIDTH:o.HIGHLIGHT_STYLE.NORMAL;e.style.outline=`2px ${a.STYLE} ${o.HIGHLIGHT_COLOR}`,e.style.outlineOffset=a.OFFSET,e.style.backgroundColor=o.HIGHLIGHT_BG,t.isActive&&(e.style.cursor="crosshair")},i=e=>{e.style.outline="",e.style.outlineOffset="",e.style.backgroundColor="",e.style.cursor=""},E=e=>{let l=e.tagName.toLowerCase()==="svg",a=e.closest("svg")!==null;return!l&&a},L=e=>e.hasAttribute("data-component-path")&&e.hasAttribute("data-component-file")&&e.hasAttribute("data-component-line"),h=u(e=>{if(!t.isActive||!L(e.target)||e.target.tagName.toLowerCase()==="html"||E(e.target))return;if(t.hoveredElement){let m=`[data-component-path="${t.hoveredElement.getAttribute("data-component-path")}"][data-component-file="${t.hoveredElement.getAttribute("data-component-file")}"][data-component-line="${t.hoveredElement.getAttribute("data-component-line")}"]`;document.querySelectorAll(m).forEach(c=>{c.classList.contains("gpt-selected-element")||i(c)})}t.hoveredElement=e.target;let l=`[data-component-path="${e.target.getAttribute("data-component-path")}"][data-component-file="${e.target.getAttribute("data-component-file")}"][data-component-line="${e.target.getAttribute("data-component-line")}"]`;document.querySelectorAll(l).forEach(m=>{m.classList.contains("gpt-selected-element")||r(m)}),n(t.hoveredElement),t.tooltip.style.display="block",t.tooltip.style.opacity="1"},o.DEBOUNCE_DELAY),O=e=>{let l=e.getAttribute("data-component-path")||null,a=e.getAttribute("data-component-file")||null,m=e.tagName.toLowerCase(),_=parseInt(e.getAttribute("data-component-line")||"0",10),c=e.getAttribute("data-component-content")||null;return{filePath:l,fileName:a,elementType:m,lineNumber:_,content:c}},g=e=>{if(t.isActive&&!(!L(e.target)||e.target.tagName.toLowerCase()==="html"||E(e.target))&&(e.preventDefault(),e.stopPropagation(),t.hoveredElement)){let l=O(t.hoveredElement);t.hoveredElement.classList.add("gpt-selected-element");let a=Math.abs(t.hoveredElement.getBoundingClientRect().width-window.innerWidth)<5,m=a?o.HIGHLIGHT_STYLE.FULL_WIDTH:o.HIGHLIGHT_STYLE.NORMAL;a?(t.hoveredElement.style.outline=`2px solid ${o.HIGHLIGHT_COLOR}`,t.hoveredElement.style.outlineOffset=m.OFFSET):(t.hoveredElement.style.outline=`2px solid ${o.HIGHLIGHT_COLOR}`,t.hoveredElement.style.outlineOffset="0"),t.hoveredElement.style.backgroundColor=`${o.HIGHLIGHT_BG}`,d({type:"ELEMENT_CLICKED",payload:l,isMultiSelect:e.metaKey||e.ctrlKey}),e.metaKey||e.ctrlKey||d({type:"TOGGLE_PICK_AND_EDIT_REQUESTED",payload:!1})}},v=u(()=>{if(t.isActive){if(t.hoveredElement){let e=`[data-component-path="${t.hoveredElement.getAttribute("data-component-path")}"][data-component-file="${t.hoveredElement.getAttribute("data-component-file")}"][data-component-line="${t.hoveredElement.getAttribute("data-component-line")}"]`;document.querySelectorAll(e).forEach(a=>{a.classList.contains("gpt-selected-element")||i(a)}),t.hoveredElement=null}S()}},o.DEBOUNCE_DELAY),S=()=>{t.tooltip.style.opacity="0",t.tooltip.style.display="none"},C=()=>{t.scrollTimeout&&clearTimeout(t.scrollTimeout),S(),t.hoveredElement&&!t.hoveredElement.classList.contains("gpt-selected-element")&&i(t.hoveredElement),t.scrollTimeout=setTimeout(()=>{t.scrollTimeout=null;let e=document.elementFromPoint(t.mouseX,t.mouseY);e&&t.isActive&&h({target:e})},o.SCROLL_DEBOUNCE)},b=e=>{t.isActive&&(e.target.tagName.toLowerCase()==="input"||e.target.tagName.toLowerCase()==="textarea"||e.target.tagName.toLowerCase()==="select")&&e.preventDefault()},f=e=>{if(t.isActive)return e.preventDefault(),e.stopPropagation(),!1},U=()=>{document.addEventListener("mouseover",h),document.addEventListener("mouseout",v),document.addEventListener("click",g,!0),window.addEventListener("scroll",C,{passive:!0}),document.addEventListener("mousedown",b,!0);let e=document.createElement("style");e.textContent=`
        * {
          transition: none !important;
          animation: none !important;
          translate: none !important;
          scroll-behavior: auto !important;
          cursor: crosshair !important;
        }
      `,document.head.appendChild(e),t.styleElement=e,document.addEventListener("click",f,!0),document.addEventListener("submit",f,!0),document.addEventListener("touchstart",f,!0),document.addEventListener("touchend",f,!0)},H=()=>{document.removeEventListener("mouseover",h),document.removeEventListener("mouseout",v),document.removeEventListener("click",g),window.removeEventListener("scroll",C),document.removeEventListener("mousedown",b,!0),document.removeEventListener("click",f,!0),document.removeEventListener("submit",f,!0),document.removeEventListener("touchstart",f,!0),document.removeEventListener("touchend",f,!0),t.styleElement&&(t.styleElement.remove(),t.styleElement=null),document.body.style.cursor="",document.body.style.userSelect="",document.body.style.msUserSelect="",document.body.style.mozUserSelect="",t.hoveredElement&&(t.hoveredElement.classList.contains("gpt-selected-element")||i(t.hoveredElement),t.hoveredElement=null),S()},$=e=>{if(e.key==="Escape"&&t.isActive){e.preventDefault(),e.stopPropagation(),d({type:"TOGGLE_PICK_AND_EDIT_REQUESTED",payload:!1});return}(e.altKey&&e.key.toLowerCase()==="s"||e.key==="\xDF")&&(e.preventDefault(),e.stopPropagation(),d({type:"TOGGLE_PICK_AND_EDIT_REQUESTED",payload:null}))},P=(e,l)=>document.elementFromPoint(e,l),W=e=>{var l;try{if(!(e!=null&&e.origin)||!((l=e==null?void 0:e.data)!=null&&l.type)||!o.ALLOWED_ORIGINS.includes(e.origin))return;switch(e.data.type){case"TOGGLE_SELECTOR":let a=!!e.data.payload;if(t.isActive!==a)if(t.isActive=a,t.isActive){let c=P(t.mouseX,t.mouseY);c&&h({target:c}),U()}else H(),document.querySelectorAll('[style*="outline"], [style*="background-color"]').forEach(w=>{w.classList.contains("gpt-selected-element")||(i(w),w.style.cursor="")}),t.reset();break;case"UPDATE_SELECTED_ELEMENTS":if(!Array.isArray(e.data.payload)){console.error("Invalid payload for UPDATE_SELECTED_ELEMENTS");return}let m=e.data.payload;document.querySelectorAll(".gpt-selected-element").forEach(c=>{c.classList.remove("gpt-selected-element"),c!==t.hoveredElement&&i(c)}),m.forEach(c=>{if(!(c!=null&&c.filePath)||!(c!=null&&c.fileName)||!(c!=null&&c.lineNumber)){console.error("Invalid element data:",c);return}let{filePath:w,fileName:K,lineNumber:j}=c,q=`[data-component-path="${w}"][data-component-file="${K}"][data-component-line="${j}"]`;document.querySelectorAll(q).forEach(y=>{y.classList.add("gpt-selected-element"),Math.abs(y.getBoundingClientRect().width-window.innerWidth)<5?(y.style.outline=`2px solid ${o.HIGHLIGHT_COLOR}`,y.style.outlineOffset=o.HIGHLIGHT_STYLE.FULL_WIDTH.OFFSET):(y.style.outline=`2px solid ${o.HIGHLIGHT_COLOR}`,y.style.outlineOffset="0"),y.style.backgroundColor=`${o.HIGHLIGHT_BG}`})});break;case"GET_SELECTOR_STATE":d({type:"SELECTOR_STATE_RESPONSE",payload:{isActive:t.isActive}});break;default:console.warn("Unknown message type:",e.data.type)}}catch(a){console.error("Error handling message:",a),H(),t.reset()}},Y=e=>{t.mouseX=e.clientX,t.mouseY=e.clientY},B=()=>{d({type:"REQUEST_PICKER_STATE"}),d({type:"REQUEST_SELECTED_ELEMENTS"})};(()=>{try{p(),window.addEventListener("message",W),document.addEventListener("keydown",$),document.addEventListener("mousemove",Y),d({type:"SELECTOR_SCRIPT_LOADED"}),B()}catch(e){console.error("Failed to initialize selector script:",e)}})()})();var M=()=>{let o=document.createElement("script");o.textContent=`
    ${D}
  `,document.head.appendChild(o)};var ot=()=>{window.top!==window.self&&(F(),k(),x(),M())};ot();})();
